<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>IoT Arroz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; padding: 20px; }
    h1 { color: green; }
    .card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .grafico-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    canvas {
      max-width: 300px;
      width: 100%;
      height: 200px;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ± Sistema IoT â€“ Replante de Arroz</h1>

  <div class="card">ğŸ’§ Humedad: <span id="humedad">Cargando...</span> %</div>
  <div class="card">ğŸŒ¡ï¸ Temp. Suelo: <span id="temp_suelo">Cargando...</span> Â°C</div>
  <div class="card">ğŸŒ¤ï¸ Temp. Ambiente: <span id="temp_amb">Cargando...</span> Â°C</div>
  <div class="card">â˜€ï¸ Luz: <span id="luz">Cargando...</span></div>
  <div class="card">ğŸ§ª pH: <span id="ph">Cargando...</span></div>

  <h2>GrÃ¡ficos de Sensores</h2>
  <div class="grafico-container">
    <div>
      <h3>GrÃ¡fico de Humedad</h3>
      <canvas id="graficoHumedad"></canvas>
    </div>
    <div>
      <h3>GrÃ¡fico de Temp. Suelo</h3>
      <canvas id="graficoTempSuelo"></canvas>
    </div>
    <div>
      <h3>GrÃ¡fico de Temp. Ambiente</h3>
      <canvas id="graficoTempAmb"></canvas>
    </div>
    <div>
      <h3>GrÃ¡fico de Luz</h3>
      <canvas id="graficoLuz"></canvas>
    </div>
    <div>
      <h3>GrÃ¡fico de pH</h3>
      <canvas id="graficoPH"></canvas>
    </div>
  </div>

  <h2>ğŸ¤– Asistencia IA</h2>
  <p id="mensajeIA">Cargando...</p>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    fetch('/api/datos')
      .then(response => response.json())
      .then(data => {
        // Actualizar datos en la pÃ¡gina
        document.getElementById('humedad').innerText = data.humedad;
        document.getElementById('temp_suelo').innerText = data.temp_suelo;
        document.getElementById('temp_amb').innerText = data.temp_amb;
        document.getElementById('luz').innerText = data.luz;
        document.getElementById('ph').innerText = data.ph;

        // LÃ³gica IA
        let mensajeIA = "Condiciones normales";
        if (data.humedad < 40) mensajeIA = "âš ï¸ Humedad baja, posible falta de riego";
        if (data.temp_suelo > 35) mensajeIA = "âš ï¸ Temperatura del suelo elevada";
        if (data.ph < 5.5 || data.ph > 6.5) mensajeIA = "âš ï¸ pH fuera del rango Ã³ptimo";
        document.getElementById('mensajeIA').innerText = mensajeIA;

        // FunciÃ³n para crear grÃ¡ficos
        const createChart = (canvasId, label, dataValues) => {
          const ctx = document.getElementById(canvasId).getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['1', '2', '3', '4', '5'],  // Puedes cambiar estas etiquetas
              datasets: [{
                label: label,
                data: dataValues,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: true
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100
                }
              }
            }
          });
        };

        // Crear grÃ¡ficos con los datos
        createChart('graficoHumedad', 'Humedad (%)', [data.humedad, data.humedad + 1, data.humedad - 2, data.humedad + 3, data.humedad - 1]);
        createChart('graficoTempSuelo', 'Temp. Suelo (Â°C)', [data.temp_suelo, data.temp_suelo + 1, data.temp_suelo - 1, data.temp_suelo + 2, data.temp_suelo]);
        createChart('graficoTempAmb', 'Temp. Ambiente (Â°C)', [data.temp_amb, data.temp_amb + 1, data.temp_amb - 1, data.temp_amb + 2, data.temp_amb]);
        createChart('graficoLuz', 'Luz', [data.luz, data.luz + 10, data.luz - 5, data.luz + 20, data.luz]);
        createChart('graficoPH', 'pH', [data.ph, data.ph + 0.2, data.ph - 0.3, data.ph + 0.1, data.ph - 0.2]);
      })
      .catch(error => console.error('Error:', error));
  </script>
</body>
</html>
