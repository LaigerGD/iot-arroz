<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema IoT Agrícola – Replante de Arroz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
      color: #333;
    }
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }
    h1 {
      margin-top: 30px;
      color: #2d6a4f;
    }
    .chart-container {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }
    .chart {
      width: 30%;
    }
    .data-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 30px;
    }
    .data-table th, .data-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    .data-table th {
      background-color: #2d6a4f;
      color: white;
    }
    .data-table td {
      background-color: #eaf2f1;
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status p {
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sistema IoT Agrícola – Replante de Arroz</h1>
    <div class="chart-container">
      <div class="chart">
        <canvas id="humidityChart"></canvas>
      </div>
      <div class="chart">
        <canvas id="temperatureChart"></canvas>
      </div>
      <div class="chart">
        <canvas id="lightChart"></canvas>
      </div>
    </div>
    <div class="chart-container">
      <div class="chart">
        <canvas id="phChart"></canvas>
      </div>
    </div>

    <div class="status" id="status">
      <p>Analizando condiciones del cultivo...</p>
    </div>

    <table class="data-table">
      <thead>
        <tr>
          <th>Humedad (%)</th>
          <th>Temp. Suelo (°C)</th>
          <th>Temp. Ambiente (°C)</th>
          <th>Luz (lux)</th>
          <th>pH</th>
        </tr>
      </thead>
      <tbody id="data-table-body">
        <tr>
          <td id="humidity-data">--</td>
          <td id="soil-temp-data">--</td>
          <td id="ambient-temp-data">--</td>
          <td id="light-data">--</td>
          <td id="ph-data">--</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // Se configuran los gráficos de Chart.js
    const ctxHumidity = document.getElementById('humidityChart').getContext('2d');
    const ctxTemperature = document.getElementById('temperatureChart').getContext('2d');
    const ctxLight = document.getElementById('lightChart').getContext('2d');
    const ctxPh = document.getElementById('phChart').getContext('2d');

    const humidityChart = new Chart(ctxHumidity, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Humedad (%)',
          data: [],
          borderColor: 'rgba(75, 192, 192, 1)',
          fill: false,
        }],
      },
    });

    const temperatureChart = new Chart(ctxTemperature, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Temperatura Suelo (°C)',
          data: [],
          borderColor: 'rgba(255, 99, 132, 1)',
          fill: false,
        }],
      },
    });

    const lightChart = new Chart(ctxLight, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Luz (lux)',
          data: [],
          borderColor: 'rgba(255, 159, 64, 1)',
          fill: false,
        }],
      },
    });

    const phChart = new Chart(ctxPh, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'pH',
          data: [],
          borderColor: 'rgba(153, 102, 255, 1)',
          fill: false,
        }],
      },
    });

    // Función para actualizar los datos en la página y los gráficos
    function updateData(data) {
      // Actualizar los datos de la tabla
      document.getElementById('humidity-data').textContent = data.humidity;
      document.getElementById('soil-temp-data').textContent = data.soilTemp;
      document.getElementById('ambient-temp-data').textContent = data.ambientTemp;
      document.getElementById('light-data').textContent = data.light;
      document.getElementById('ph-data').textContent = data.ph;

      // Actualizar los gráficos
      const currentTime = new Date().toLocaleTimeString();
      humidityChart.data.labels.push(currentTime);
      humidityChart.data.datasets[0].data.push(data.humidity);
      humidityChart.update();

      temperatureChart.data.labels.push(currentTime);
      temperatureChart.data.datasets[0].data.push(data.soilTemp);
      temperatureChart.update();

      lightChart.data.labels.push(currentTime);
      lightChart.data.datasets[0].data.push(data.light);
      lightChart.update();

      phChart.data.labels.push(currentTime);
      phChart.data.datasets[0].data.push(data.ph);
      phChart.update();

      // Actualizar el estado de la conexión
      document.getElementById('status').classList.remove('success');
      document.getElementById('status').classList.add('success');
      document.getElementById('status').textContent = 'Conexión exitosa. Datos recibidos.';
    }

    // Simulando la obtención de datos desde un servidor
    setInterval(() => {
      // Simulación de datos recibidos
      const data = {
        humidity: (Math.random() * (90 - 60) + 60).toFixed(2),
        soilTemp: (Math.random() * (35 - 25) + 25).toFixed(2),
        ambientTemp: (Math.random() * (30 - 20) + 20).toFixed(2),
        light: (Math.random() * (1000 - 300) + 300).toFixed(2),
        ph: (Math.random() * (7 - 5) + 5).toFixed(2),
      };
      updateData(data);
    }, 5000); // Actualiza los datos cada 5 segundos
  </script>
</body>
</html>
