<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema IoT Agrícola – Replante de Arroz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Librería para gráficos -->
  <link rel="stylesheet" href="styles.css"> <!-- Puedes agregar tus propios estilos -->
</head>
<body>
  <header>
    <h1>Sistema IoT Agrícola – Replante de Arroz</h1>
  </header>
  
  <div class="container">
    <div class="data-box">
      <h3>Humedad (%)</h3>
      <p id="humedad">-- %</p>
    </div>
    <div class="data-box">
      <h3>Temp. Suelo (°C)</h3>
      <p id="temp_suelo">-- °C</p>
    </div>
    <div class="data-box">
      <h3>Temp. Ambiente (°C)</h3>
      <p id="temp_ambiente">-- °C</p>
    </div>
    <div class="data-box">
      <h3>Luz (lux)</h3>
      <p id="luz">-- lux</p>
    </div>
    <div class="data-box">
      <h3>pH</h3>
      <p id="ph">--</p>
    </div>
  </div>

  <!-- Gráficos con Chart.js -->
  <div class="chart-container">
    <canvas id="humedadChart"></canvas>
    <canvas id="tempSueloChart"></canvas>
  </div>

  <footer>
    <p>IoT Arroz © 2025</p>
  </footer>

  <script>
    // Función para obtener los datos del servidor
    async function fetchData() {
      try {
        const response = await fetch('https://iot-arroz.onrender.com/api/data'); // URL de tu servidor
        const data = await response.json();

        // Actualizar los valores de la página con los datos del servidor
        document.getElementById('humedad').innerText = `${data.humedad}%`;
        document.getElementById('temp_suelo').innerText = `${data.temp_suelo} °C`;
        document.getElementById('temp_ambiente').innerText = `${data.temp_ambiente} °C`;
        document.getElementById('luz').innerText = `${data.luz} lux`;
        document.getElementById('ph').innerText = `${data.ph}`;

        // Llamar a la función de actualización de gráficos
        updateCharts(data);
      } catch (error) {
        console.error('Error al obtener los datos:', error);
      }
    }

    // Función para actualizar los gráficos
    function updateCharts(data) {
      humedadChart.data.datasets[0].data.push(data.humedad); // Agregar dato al gráfico de humedad
      tempSueloChart.data.datasets[0].data.push(data.temp_suelo); // Agregar dato al gráfico de temperatura del suelo
      humedadChart.update();
      tempSueloChart.update();
    }

    // Llamar la función cada 5 segundos
    setInterval(fetchData, 5000);

    // Inicializar los gráficos con Chart.js
    const ctxHumedad = document.getElementById('humedadChart').getContext('2d');
    const ctxTempSuelo = document.getElementById('tempSueloChart').getContext('2d');

    const humedadChart = new Chart(ctxHumedad, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Humedad (%)',
          data: [],
          borderColor: 'rgb(0, 123, 255)',
          fill: false,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            type: 'linear',
            position: 'bottom'
          }
        }
      }
    });

    const tempSueloChart = new Chart(ctxTempSuelo, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Temperatura del Suelo (°C)',
          data: [],
          borderColor: 'rgb(255, 99, 132)',
          fill: false,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            type: 'linear',
            position: 'bottom'
          }
        }
      }
    });
  </script>
</body>
</html>
